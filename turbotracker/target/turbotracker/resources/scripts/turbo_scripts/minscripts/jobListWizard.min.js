var errorMessage=[];
jQuery(document).ready(function(){$(".datepicker").datepicker();$("#changeStatusId").hide();$("#tabs_main_job").tabs({cache:!0,ajaxOptions:{data:{jobNumber:$("#jobNumber_ID").text(),jobName:$("#jobName_ID").text(),jobCustomer:$("#jobCustomerName_ID").text()},error:function(a,b,c,h){$(h.hash).html("<div align='center' style='height: 350px;padding-top: 200px;'><label style='font-size : 17px;margin-left: 30px;vertical-align: middle;'>Sorry, Couldn't load this tab. Please try again later.</label></div>")}},load:function(a,
b){$(b.panel).find(".tab-loading").remove()},select:function(a,b){var c=$(b.panel);c.is(":empty")&&c.append("<div class='tab-loading' align='center' style='height: 350px;padding-top: 200px;background-color: #DDBA82'><img src='./../resources/scripts/jquery-autocomplete/loading11.gif'></div>")}});$("#textarea").css("display","none")});
function ChangeJobStatus(){var a=new Date,b=a.getMonth()+1,b=""+b+"/"+a.getDate()+"/"+a.getFullYear(),c=$("#jobStatusList").val(),h=$(".jobHeader_JobNumber").val(),f="";if("3"===c){errorMessage=[];var e=jQuery(document.createElement("div"));$("#TaxTerritory").val();var g=$("#jobMain_TaxTerritory").val(),d=$("#jobMain_salesRepsList").val();$("#salesRepId").val();var k=$("#estomattedHiddenID").val(),l=$("#jobContractAmount").val(),a="";""===g&&errorMessage.push("'Tax Territory'");""===d&&errorMessage.push("'Salesman'");
""!==k&&""!==l&&"0.0000"!==k&&"0.0000"!==l||errorMessage.push("'Contract Amount' and 'Estimated Cost' in Quote page");""===$(".customerNameField").val()?errorMessage.push("'Customer'"):""===$("#jobHeader_JobCustomerName_id").val()&&errorMessage.push("'Customer'");g="Following fields are mandatory for a booked job: <br/><br/>";for(d=0;d<errorMessage.length;d++)g=g+(d+1)+". "+errorMessage[d]+"<br/>",""!==errorMessage&&(jQuery(e).html('<span style="color:#FF0066;">'+g+'</span><br><hr style="color: #cb842e;">'),
jQuery(e).dialog({modal:!0,title:"Alert",width:420,buttons:[{height:30,text:"OK",click:function(){$(this).dialog("close")}}]}).dialog("open"),$("div.ui-dialog-buttonpane.ui-widget-content.ui-helper-clearfix").css("margin","-1.5em 0 0 0"),$("div.ui-dialog-buttonpane.ui-widget-content.ui-helper-clearfix").css("padding"," 0.3em 1em 0.1em .4em"));if(0!=errorMessage.length)return b=getUrlVars().jobStatus,"Bid"===b?a="0":"Planning"===b?a="-4":"Budget"===b?a="6":"Quote"===b?a="1":"Submitted"===b?a="5":"Booked"===
b?a="3":"Closed"===b?a="4":"Lost"===b?a="2":"Abandoned"===b?a="-1":"Rejected"===b?a="-2":"Over Budget"===b&&(a="-3"),$("#jobStatusList option[value="+a+"]").attr("selected",!0),!1}"3"===c?f="BookedDate":"4"===c?f="ClosedDate":"5"===c&&(f="Submitted");$.ajax({url:"job_controller/jobStatus",mtype:"POST",data:"jobNumber="+h+"&jobStatus="+c+"&dateType="+f+"&date="+b,success:function(a){var b=getUrlVars().jobNumber,e=getUrlVars().jobName,d="";"0"===c?d="Bid":"-4"===c?d="Planning":"6"===c?d="Budget":"1"===
c?d="Quote":"5"===c?d="Submitted":"3"===c?(d="Booked",b=a):"4"===c?d="Closed":"2"===c?d="Lost":"-1"===c?d="Abandoned":"-2"===c?d="Rejected":"-3"===c&&(d="Over Budget");document.location.href="./jobflow?token=view&jobNumber="+b+"&jobName="+e+"&jobStatus="+d}});return 0}function saveJob(){$(".requiredSave").show();$("#jobStatusField").val("Bid")}
function customFormatDate(a){if(""===a)return"";a=a.split(" ");2<a.length&&(a=parseSpecializedDate(a),a=a.split(" "));a=a[0].split("-");return a[1]+"/"+a[2]+"/"+a[0]}function customFormatDateTime(a){if(""===a)return"";var b=a.split(" ");2<b.length&&(a=parseSpecializedDate(a),b=a.split(" "));a=b[0].split("-");return void 0!==b[1]?(b=b[1].split(":"),a=a[1]+"/"+a[2]+"/"+a[0]+(" "+b[0]+":"+b[1])):a=a[1]+"/"+a[2]+"/"+a[0]}
function parseSpecializedDate(a){a=a.split(" ");var b=[];b.Jan="01";b.Feb="02";b.Mar="03";b.Apr="04";b.May="05";b.Jun="06";b.Jul="07";b.Aug="08";b.Sep="09";b.Oct="10";b.Nov="11";b.Dec="12";return a[5]+"-"+b[a[1]]+"-"+a[2]+" "+a[3]}
$(function(){var a={},b="";$("#searchJob").autocomplete({minLength:3,timeout:1E3,open:function(){$(".ui-autocomplete").prepend('<div style="font-size: 15px;"><b><a href="./jobflow?token=new" style="color:#CB842E;font-family: Verdana,Arial,sans-serif;font-size: 0.8em;">+ Add New</a></b></div>');$(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading")},select:function(a,b){var f=b.item.value.replace("[","`").split("`"),e=f[0],e=e.replace(/&/g,"``"),e="`"+e+"`",g=f[1].replace("]"," ");$.ajax({url:"./search/searchjobcustomer",
mType:"GET",data:{jobnumber:g,jobname:e},success:function(a){$.each(a,function(a,b){status=b.jobStatus;jobCustomer=b.customerName});null===jobCustomer&&(jobCustomer="");updateJobstatus(g,status);e=e.replace("`","");e=e.replace("`","");window.location.href="./jobflow?token=view&jobNumber="+g+"&jobName="+e+"&jobCustomer="+jobCustomer+"&jobStatus="+status+""},error:function(a){a=$(a.responseText).find("u").html();var b=jQuery(document.createElement("div"));jQuery(b).html('<span style="color:red;"><b>Error: '+
a+"</b></span>");jQuery(b).dialog({modal:!0,width:500,height:250,title:"Fatal Error.",buttons:[{height:35,text:"OK",click:function(){$(this).dialog("close")}}]}).dialog("open")}})},source:function(c,h){var f=c.term;f in a?h(a[f]):b=$.getJSON("search/searchjoblist",c,function(c,g,d){a[f]=c;d===b&&h(c)})},error:function(a){$(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading")}})});