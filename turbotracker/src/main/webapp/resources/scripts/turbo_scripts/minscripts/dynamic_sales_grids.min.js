var salesUserId=$("#salesRepUserID").val();getSalesReps(salesUserId);$(window).bind("load",function(){$("#upcoming").bubbletip($("#tip1_down"),{deltaDirection:"down",offsetTop:115})});jQuery(document).ready(function(){$("#search").hide();$("#intro").hide();setTimeout("loadSalesGrid();",1E3);loadCustomerFilterGrid("","","")});
function formatCurrency(b){if(""===b||null===b)return"$0.00";b=b.toString().replace(/\$|\,/g,"");dblValue=parseFloat(b);blnSign=dblValue==(dblValue=Math.abs(dblValue));dblValue=Math.floor(100*dblValue+0.50000000001);intCents=dblValue%100;strCents=intCents.toString();dblValue=Math.floor(dblValue/100).toString();10>intCents&&(strCents="0"+strCents);for(b=0;b<Math.floor((dblValue.length-(1+b))/3);b++)dblValue=dblValue.substring(0,dblValue.length-(4*b+3))+","+dblValue.substring(dblValue.length-(4*b+3));
return(blnSign?"":"-")+"$"+dblValue+"."+strCents}jQuery(function(){jQuery("#customerDialogBox").dialog({autoOpen:!1,height:330,width:730,title:"Change Order ",modal:!0,buttons:{},close:function(){return!0}})});function customerFilterDialog(){jQuery("#customerDialogBox").dialog("open")}
$(function(){var b={},c="";$("#customerFilterListID").autocomplete({minLength:3,timeout:1E3,select:function(a,b){$.ajax({url:"./search/searchrolodexForSale",mType:"GET",data:{rolodex:b.item.manufactureID},success:function(a){var b=a.createdByID;a=a.changedByID;var c=0;0!==b?c=b:0!==a?c=a:0!==b&&0!==a&&(c=b);$("#UpcomingBidsGrid").jqGrid("setGridParam",{postData:{salesRepId:c}});$("#UpcomingBidsGrid").trigger("reloadGrid")},error:function(){}})},source:function(a,e){var d=a.term;d in b?e(b[d]):c=$.getJSON("search/searchCustomerListForUpComingBids",
a,function(a,g,f){b[d]=a;f===c&&e(a)})},error:function(){$(".ui-autocomplete-loading").removeClass("ui-autocomplete-loading")}})});
function loadCustomerFilterGrid(b,c,a){$("#customerFilterSearchGrid").jqGrid({url:"./search/salesupcomingForSale",datatype:"JSON",mtype:"GET",postData:{createdLoginID:b,changedLoginID:c,rxMaster:a},colNames:["Job #","CustomerUpComingList"],colModel:[{name:"jobNo",index:"jobNo",align:"center",width:30},{name:"jobName",index:"jobName",align:"center",width:150}],rowNum:1E3,pgbuttons:!1,recordtext:"",rowList:[],pgtext:null,viewrecords:!1,sortname:"Name",sortorder:"asc",imgpath:"themes/basic/images",caption:"Customer Filter UpComing List",
height:150,width:700,altRows:!0,altclass:"myAltRowClass",loadComplete:function(){},jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata"},loadError:function(){},onSelectRow:function(){}})}function cancelUpComingCustomer(){jQuery("#customerDialogBox").dialog("close")}
var arrColNamesUpcomingBids=["Date","Job Name","Job #"],arrColModelUpcomingBids=[{name:"bidDate",index:"bidDate",align:"center",width:60},{name:"jobName",index:"jobName",align:"",width:90},{name:"jobNo",index:"jobNo",align:"center",width:30}],arrColNamesPendingQuotes=["Date","Job Name","Job #"],arrColModelPendingQuotes=[{name:"bidDate",index:"bidDate",align:"center",width:60},{name:"jobName",index:"jobName",align:"",width:90},{name:"jobNo",index:"jobNo",align:"center",width:30}],arrColNamesAwarded=
["Job #","Job Name"],arrColModelAwarded=[{name:"jobNo",index:"jobNo",align:"center",width:30},{name:"jobName",index:"jobName",align:"",width:90}];function loadSalesGrid(){upcomingBids_grid(arrColNamesUpcomingBids,arrColModelUpcomingBids);pendingBids_grid(arrColNamesPendingQuotes,arrColModelPendingQuotes);awarded_grid(arrColNamesAwarded,arrColModelAwarded);return!0}
var colName_assignedSalesman="Assigned Salesman",colModel_assignedSalesman={name:"assignedSalesman",index:"assignedSalesman",align:"center",width:60},colName_assignedCustomer="Assigned Customers",colModel_assignedcustomer={name:"assignedCustomers",index:"assignedCustomers",align:"center",width:60},colName_allCustomers="All Customers",colModel_allCustomers={name:"allCustomer",index:"allCustomer",align:"center",width:60},colName_architect="Architect",colModel_architect={name:"architect",index:"architect",
align:"center",width:60},colName_engineer="Engineer",colModel_engineer={name:"engineer",index:"engineer",align:"center",width:60},colName_generalContractor="General Contractor",colModel_generalContractor={name:"generalContractor",index:"generalContractor",align:"center",width:60},colName_assignedTakeoffby="Assigned Take-off By",colModel_assignedTakeoffby={name:"assignedTakeoffBy",index:"assignedTakeoffBy",align:"center",width:60},colName_assignedQuoteby="Assigned Quote By",colModel_assignedQuoteby=
{name:"assignedQuoteBy",index:"assignedQuoteBy",align:"center",width:60},colName_lowBidder="Low Bidder",colModel_lowBidder={name:"lowbidder",index:"lowbidder",align:"center",width:60},colName_QuoteAmount="Quote Amount($)",colModel_QuoteAmount={name:"quoteAmount",index:"quoteAmount",align:"center",width:60,formatter:customCurrencyFormatter};
function addRemoveUpcomingGridColumns(){for(var b=document.getElementsByClassName("UpcomingOptions"),c=0;c<b.length;c++){var a=b[c];"checkbox"===a.type&&a.checked?"Date"!=a.value&&("Job Name"!=a.value&&!isExistInArray(arrColNamesUpcomingBids,a.value))&&("Assigned Salesman"===a.value&&!isExistInArray(arrColNamesUpcomingBids,"Assigned Salesman")?(arrColNamesUpcomingBids.push(colName_assignedSalesman),arrColModelUpcomingBids.push(colModel_assignedSalesman)):"Assigned Customers"===a.value&&!isExistInArray(arrColNamesUpcomingBids,
"Assigned Customers")?(arrColNamesUpcomingBids.push(colName_assignedCustomer),arrColModelUpcomingBids.push(colModel_assignedcustomer)):"All Customers"===a.value&&!isExistInArray(arrColNamesUpcomingBids,"All Customers")?(arrColNamesUpcomingBids.push(colName_allCustomers),arrColModelUpcomingBids.push(colModel_allCustomers)):"Architect"===a.value&&!isExistInArray(arrColNamesUpcomingBids,"Architect")?(arrColNamesUpcomingBids.push(colName_architect),arrColModelUpcomingBids.push(colModel_architect)):"Engineer"===
a.value&&!isExistInArray(arrColNamesUpcomingBids,"Engineer")?(arrColNamesUpcomingBids.push(colName_engineer),arrColModelUpcomingBids.push(colModel_engineer)):"General Contractor"===a.value&&!isExistInArray(arrColNamesUpcomingBids,"General Contractor")&&(arrColNamesUpcomingBids.push(colName_generalContractor),arrColModelUpcomingBids.push(colModel_generalContractor))):"checkbox"===a.type&&!a.checked&&("Assigned Salesman"===a.value?(removeA(arrColNamesUpcomingBids,colName_assignedSalesman),removeA(arrColModelUpcomingBids,
colModel_assignedSalesman)):"Assigned Customers"===a.value?(removeA(arrColNamesUpcomingBids,colName_assignedCustomer),removeA(arrColModelUpcomingBids,colModel_assignedcustomer)):"All Customers"===a.value?(removeA(arrColNamesUpcomingBids,colName_allCustomers),removeA(arrColModelUpcomingBids,colModel_allCustomers)):"Architect"===a.value?(removeA(arrColNamesUpcomingBids,colName_architect),removeA(arrColModelUpcomingBids,colModel_architect)):"Engineer"===a.value?(removeA(arrColNamesUpcomingBids,colName_engineer),
removeA(arrColModelUpcomingBids,colModel_engineer)):"General Contractor"===a.value&&(removeA(arrColNamesUpcomingBids,colName_generalContractor),removeA(arrColModelUpcomingBids,colModel_generalContractor)))}$("#UpcomingBidsGrid").jqGrid("GridUnload");upcomingBids_grid(arrColNamesUpcomingBids,arrColModelUpcomingBids);$("#UpcomingBidsGrid").trigger("reloadGrid");return!0}
var upcomingBids_grid=function(b,c){var a=jQuery("#SalesRepComboList").val(),a=null===a?10:jQuery("#SalesRepComboList").val();$("#UpcomingBidsGrid").jqGrid({url:"./salescontroller/salesupcoming",datatype:"json",mtype:"GET",postData:{salesRepId:a},pager:"",colNames:b,colModel:c,rowNum:1E3,pgbuttons:!1,recordtext:"",rowList:[],pgtext:null,viewrecords:!1,altRows:!0,altclass:"myAltRowClass",sortname:"bidDate",pgbuttons:!1,sortorder:"asc",imgpath:"themes/basic/images",caption:!1,height:100,width:1130,
rownumbers:!0,rownumWidth:45,loadComplete:function(){},jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata"},loadError:function(){},ondblClickRow:function(){var a=$("#UpcomingBidsGrid").jqGrid("getGridParam","selrow"),b=$("#UpcomingBidsGrid").jqGrid("getCell",a,2),a=$("#UpcomingBidsGrid").jqGrid("getCell",a,3),b="token=view&"+getQryStr(a,b);document.location.href="./jobflow?"+b}});return!0};
function addRemovePendingGridColumns(){for(var b=document.getElementsByClassName("PendingOptions"),c=0;c<b.length;c++){var a=b[c];"checkbox"===a.type&&a.checked?"Date"!=a.value&&("Job Name"!=a.value&&"Assigned"!=a.value&&!isExistInArray(arrColNamesPendingQuotes,a.value))&&("Assigned Customers"===a.value&&!isExistInArray(arrColNamesPendingQuotes,"Assigned Customers")?(arrColNamesPendingQuotes.push(colName_assignedCustomer),arrColModelPendingQuotes.push(colModel_assignedcustomer)):"Quote Amount"===
a.value&&!isExistInArray(arrColNamesPendingQuotes,"Quote Amount($)")&&(arrColNamesPendingQuotes.push(colName_QuoteAmount),arrColModelPendingQuotes.push(colModel_QuoteAmount))):"checkbox"===a.type&&!a.checked&&("Assigned Customers"===a.value?(removeA(arrColNamesPendingQuotes,colName_assignedCustomer),removeA(arrColModelPendingQuotes,colModel_assignedcustomer)):"Quote Amount($)"===a.value&&(removeA(arrColNamesPendingQuotes,colName_QuoteAmount),removeA(arrColModelPendingQuotes,colModel_QuoteAmount)))}$("#PendingQuotesGrid2").jqGrid("GridUnload");
pendingBids_grid(arrColNamesPendingQuotes,arrColModelPendingQuotes);$("#PendingQuotesGrid2").trigger("reloadGrid");return!0}
var pendingBids_grid=function(b,c){var a=jQuery("#SalesRepComboList").val(),a=null===a?10:jQuery("#SalesRepComboList").val();$("#PendingQuotesGrid2").jqGrid({url:"./salescontroller/salespending",datatype:"json",mtype:"GET",postData:{salesRepId:a},pager:"",colNames:b,colModel:c,rowNum:1E3,pgbuttons:!1,recordtext:"",rowList:[],pgtext:null,viewrecords:!1,altRows:!0,altclass:"myAltRowClass",sortname:"employeeId",pgbuttons:!1,sortorder:"asc",imgpath:"themes/basic/images",caption:!1,height:150,width:1130,
rownumbers:!0,loadComplete:function(){},jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata"},loadError:function(){},ondblClickRow:function(){var a=$("#PendingQuotesGrid2").jqGrid("getGridParam","selrow"),b=$("#PendingQuotesGrid2").jqGrid("getCell",a,2),a=$("#PendingQuotesGrid2").jqGrid("getCell",a,3),b="token=view&"+getQryStr(a,b);document.location.href="./jobflow?"+b}});return!0};
function addRemoveAwardedGridColumns(){for(var b=document.getElementsByClassName("AwardedOptions"),c=0;c<b.length;c++){var a=b[c];"checkbox"===a.type&&a.checked?"Date"!=a.value&&("Job Name"!=a.value&&"Assigned"!=a.value&&!isExistInArray(arrColNamesAwarded,a.value))&&("Job #"===a.value&&!isExistInArray(arrColNamesAwarded,"Job #")?(arrColNamesAwarded.push(colName_jobNo),arrColModelAwarded.push(colModel_jobNo)):"Assigned Salesman"===a.value&&!isExistInArray(arrColNamesAwarded,"Assigned Salesman")?(arrColNamesAwarded.push(colName_assignedSalesman),
arrColModelAwarded.push(colModel_assignedSalesman)):"Assigned Customers"===a.value&&!isExistInArray(arrColNamesAwarded,"Assigned Customers")?(arrColNamesAwarded.push(colName_assignedCustomer),arrColModelAwarded.push(colModel_assignedcustomer)):"All Customers"===a.value&&!isExistInArray(arrColNamesAwarded,"All Customers")?(arrColNamesAwarded.push(colName_allCustomers),arrColModelAwarded.push(colModel_allCustomers)):"Architect"===a.value&&!isExistInArray(arrColNamesAwarded,"Architect")?(arrColNamesAwarded.push(colName_architect),
arrColModelAwarded.push(colModel_architect)):"Engineer"===a.value&&!isExistInArray(arrColNamesAwarded,"Engineer")?(arrColNamesAwarded.push(colName_engineer),arrColModelAwarded.push(colModel_engineer)):"General Contractor"===a.value&&!isExistInArray(arrColNamesAwarded,"General Contractor")?(arrColNamesAwarded.push(colName_generalContractor),arrColModelAwarded.push(colModel_generalContractor)):"Low Bidder"===a.value&&!isExistInArray(arrColNamesAwarded,"Low Bidder")&&(arrColNamesAwarded.push(colName_lowBidder),
arrColModelAwarded.push(colModel_lowBidder))):"checkbox"===a.type&&!a.checked&&("Job #"===a.value?(removeA(arrColNamesAwarded,colName_jobNo),removeA(arrColModelAwarded,colModel_jobNo)):"Assigned Salesman"===a.value?(removeA(arrColNamesAwarded,colName_assignedSalesman),removeA(arrColModelAwarded,colModel_assignedSalesman)):"Assigned Customers"===a.value?(removeA(arrColNamesAwarded,colName_assignedCustomer),removeA(arrColModelAwarded,colModel_assignedcustomer)):"All Customers"===a.value?(removeA(arrColNamesAwarded,
colName_allCustomers),removeA(arrColModelAwarded,colModel_allCustomers)):"Architect"===a.value?(removeA(arrColNamesAwarded,colName_architect),removeA(arrColModelAwarded,colModel_architect)):"Engineer"===a.value?(removeA(arrColNamesAwarded,colName_engineer),removeA(arrColModelAwarded,colModel_engineer)):"General Contractor"===a.value?(removeA(arrColNamesAwarded,colName_generalContractor),removeA(arrColModelAwarded,colModel_generalContractor)):"Low Bidder"===a.value&&(removeA(arrColNamesAwarded,colName_lowBidder),
removeA(arrColModelAwarded,colModel_lowBidder)))}$("#AwardedContractors").jqGrid("GridUnload");awarded_grid(arrColNamesAwarded,arrColModelAwarded);$("#AwardedContractors").trigger("reloadGrid");return!0}
var awarded_grid=function(b,c){var a=jQuery("#SalesRepComboList").val(),a=null===a?10:jQuery("#SalesRepComboList").val();$("#AwardedContractors").jqGrid({url:"./salescontroller/salesawarded",datatype:"json",mtype:"GET",postData:{salesRepId:a},pager:"",colNames:b,colModel:c,rowNum:1E3,pgbuttons:!1,recordtext:"",rowList:[],pgtext:null,viewrecords:!1,altRows:!0,altclass:"myAltRowClass",sortname:"bidDate",pgbuttons:!1,sortorder:"asc",imgpath:"themes/basic/images",caption:!1,height:100,width:1130,rownumbers:!0,
loadComplete:function(){},jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata"},loadError:function(){},ondblClickRow:function(){var a=$("#AwardedContractors").jqGrid("getGridParam","selrow"),b=$("#AwardedContractors").jqGrid("getCell",a,2),a=$("#AwardedContractors").jqGrid("getCell",a,1),b="token=view&"+getQryStr(a,b);document.location.href="./jobflow?"+b}});return!0};
function isExistInArray(b,c){return-1===jQuery.inArray(c,b)?!1:!0}function removeA(b){for(var c,a=arguments,e=a.length,d;1<e&&b.length;)for(c=a[--e];-1!=(d=b.indexOf(c));)b.splice(d,1);return b}function getSalesReps(b){$.ajax({url:"./salescontroller",success:function(c){var a="";$.each(c,function(b,c){a=a+'<option value="'+c.userId+'">'+c.userName+"</option>"});$("#SalesRepComboList").append(a);$("#SalesRepComboList option[value="+b+"]").attr("selected",!0)},error:function(){}})}
function mouseoverpending(){$("#morepending").show()}function mouseoutpending(){$("#morepending").hide()}function mouseoverawarded(){$("#moreawarded").show()}function mouseoutawarded(){$("#moreawarded").hide()}$("#upcoming").hover(function(){$("#moreupcoming").slideToggle("500").css({display:"block",position:"top left"})},function(){$("#moreupcoming").slideToggle("500")});
function changeSalesrep(){var b=jQuery("#SalesRepComboList").val();$("#UpcomingBidsGrid").jqGrid("setGridParam",{postData:{salesRepId:b}});$("#UpcomingBidsGrid").trigger("reloadGrid");$("#PendingQuotesGrid2").jqGrid("setGridParam",{postData:{salesRepId:b}});$("#PendingQuotesGrid2").trigger("reloadGrid");$("#AwardedContractors").jqGrid("setGridParam",{postData:{salesRepId:b}});$("#AwardedContractors").trigger("reloadGrid")}function customCurrencyFormatter(b){return formatCurrency(b)}
function getQryStr(b,c){var a="";$.ajax({async:!1,url:"./search/searchjobcustomer",mType:"GET",data:{jobnumber:b,jobname:c},success:function(e){var d="";$.each(e,function(a,b){status=b.jobStatus;d=b.customerName});null===d&&(d="");updateJobstatus(b,status);return a="jobNumber="+b+"&jobName="+c+"&jobCustomer="+d+""},error:function(){}});return a};